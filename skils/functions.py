from playwright.sync_api import sync_playwright
import time
import datetime
import os
import re
import datetime
from typing import Callable, Optional
import random

since3 = [
    "مراحل تحقیق علمی","گروه‌های مواد غذایی","برچسب مواد غذایی","کاربرد گازها",
    "تبدیلات مواد","حجم و جرم مواد","واحدهای اندازه گیری","چرخه آب","آب های شیرین",
    "انواع خاک","آب‌های زیرزمینی","نور","آینه‌ها","بخش اول","بخش دوم","بخش اول",
    "بخش دوم","ریشه، برگ و دانه","کشف رابطه","دو گروه جانوران","ویژگی‌های مهره داران",
    "ماهی‌ها و دوزیستان","خزندگان، پرندگان و پستانداران","خشک کردن مواد غذایی","نمک زدن و خنک کردن "
]

chapters_since3 = [
    "فصل 1","فصل 2","فصل 2","فصل 3","فصل 3",
    "فصل 4","فصل 4","فصل 5","فصل 5","فصل 6",
    "فصل 6","فصل 7","فصل 7","فصل 9","فصل 9",
    "فصل 10","فصل 10","فصل 11","فصل 11",
    "فصل 12","فصل 12","فصل 13","فصل 13",
    "فصل 14","فصل 14 "
]

since4 = [
    "مراحل تحقیق علمی","انواع مخلوط‌ها","گرما و جداسازی مخلوط‌ها","شکل های مختلف انرژی",
    "تبدیلات انرژی","ساخت مدار و اجزای آن","رسانایی الکتریکی","اندازه‌گیری دما",
    "انتقال گرما","ویژگی‌ سنگ‌ها","انواع سنگ‌ها","خاصیت آهن‌ربایی","قطب‌های آهن‌ربا",
    "از کهکشان تا منظومه خورشیدی","زمین و ماه","بخش اول ","بخش دوم ","تنفس",
    "انتقال مواد در بدن","جانورانی که مهره ندارند","طبقه‌بندی بی‌مهره‌ها",
    "طبقه بندی گیاهان","گل و دانه","زنجیره غذایی","شبکه غذایی و زیستگاه‌ها"
]

chapters_since4 = [
    "فصل 1","فصل 2","فصل 2","فصل 3","فصل 3",
    "فصل 4","فصل 4","فصل 5","فصل 5","فصل 6",
    "فصل 6","فصل 7","فصل 7","فصل 9","فصل 9",
    "فصل 10","فصل 10","فصل 11","فصل 11",
    "فصل 12","فصل 12","فصل 13","فصل 13",
    "فصل 14","فصل 14 "
]

since5 = [
    "مراحل تحقیق علمی","تغییرات  فیزیکی و شیمیایی","سرعت تغییرات و رابطه‌اش با ما",
    "تجزیه نور","عدسی‌ها","انواع فسیل و تشکیل آن","رمزگشایی فسیل‌ها","ماهیچه‌ها و اسکلت",
    "مغز و نخاع","دیدن","حفظ سلامت چشم و گوش","چشیدن و بوییدن","لمس کردن","اهرم چیست؟",
    "کاربرد اهرم‌ها","سطح شیب دار و گُوِه","پیچ، قرقره و چرخ و محور","تشکیل خاک",
    "انواع خاک و فرسایش خاک","اثر آب بر رشد گیاه","اثر خاک، هوا و نور بر رشد گیاه",
    "از خاک تا ریشه","ساقه و برگ"
]

chapters_since5 = [
    "فصل 1","فصل 2","فصل 2","فصل 3","فصل 3",
    "فصل 4","فصل 4","فصل 5","فصل 5","فصل 6",
    "فصل 6","فصل 7","فصل 7","فصل 9","فصل 9",
    "فصل 10","فصل 10","فصل 11","فصل 11",
    "فصل 12","فصل 12","فصل 13","فصل 13",
    "فصل 14","فصل 14 "
]

since6 = [
    "مراحل تحقیق علمی","مواد طبیعی و مصنوعی","تولید کاغذ و بازیافت آن","آهن و فلزها",
    "اسیدها","امواج لرزه‌ای","لایه‌های زمین","زمین لرزه","آتش فشان","بخش اول ","بخش دوم",
    "بخش اول","بخش دوم","ذخیره انرژی","تبدیل و اندازه گیری انرژی","بخش اول","بخش دوم",
    "بخش اول","بخش دوم","شبکه غذایی","تجزیه، همزیستی و انقراض","بیماری های واگیر",
    "ارتباط سریع و آسان","تغییر فناوری‌های ارتباطی"
]

chapters_since6 = [
    "فصل 1","فصل 2","فصل 2","فصل 3","فصل 3",
    "فصل 4","فصل 4","فصل 5","فصل 5","فصل 6",
    "فصل 6","فصل 7","فصل 7","فصل 9","فصل 9",
    "فصل 10","فصل 10","فصل 11","فصل 11",
    "فصل 12","فصل 12","فصل 13","فصل 13",
    "فصل 14","فصل 14 "]

farsi3 = [
    # درس 1: محله‌ی ما
    "هم‌معنی","مخالف","هم‌خانواده","جمع و مفرد","معنی شعر","حفظ شعر","واژه‌آموزی","املا","علائم نگارشی",
    # درس 2: زنگ ورزش
    "هم‌معنی","مخالف","هم‌خانواده","جمع و مفرد","واژه‌آموزی","املا","درک مطلب","انواع جمله","علائم نگارشی",
    # درس 3: آسمان آبی، طبیعت پاک
    "هم‌معنی","مخالف","هم‌خانواده","جمع و مفرد","معنی شعر","حفظ شعر","واژه‌آموزی","املا","درک مطلب","انواع جمله","علائم نگارشی",
    # درس 4: آواز گنجشک
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی",
    # درس 5: بلدرچین و برزگر
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی",
    # درس 6: فداکاران
    "هم‌معنی","مخالف","هم‌خانواده","معنی شعر","حفظ شعر","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی",
    # درس 7: کار نیک
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی",
    # درس 8: پیراهن بهشتی
    "هم‌معنی","مخالف","هم‌خانواده","معنی شعر","حفظ شعر","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی",
    # درس 9: بوی نرگس
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی",
    # درس 10: یار مهربان
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","حفظ شعر","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی",
    # درس 11: نویسنده‌ی بزرگ
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی",
    # درس 12: ایران عزیز
    "هم‌معنی","مخالف","هم‌خانواده","معنی شعر","واژه‌آموزی","درک مطلب",
    # درس 14: ایران آباد
    "هم‌معنی","مخالف","هم‌خانواده","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی",
    # درس 15: دریا
    "هم‌معنی","مخالف","هم‌خانواده","معنی شعر","واژه‌آموزی",
    # درس 16: اگر جنگل نباشد
    "هم‌معنی","مخالف","هم‌خانواده","معنی شعر","حفظ شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی",
    # درس 17: چشم‌های آسمان
    "هم‌معنی","مخالف","هم‌خانواده","معنی شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی",
]

chapters_farsi3 = [
    # درس 1
    *["درس 1"]*9,
    # درس 2
    *["درس 2"]*9,
    # درس 3
    *["درس 3"]*11,
    # درس 4
    *["درس 4"]*8,
    # درس 5
    *["درس 5"]*8,
    # درس 6
    *["درس 6"]*9,
    # درس 7
    *["درس 7"]*9,
    # درس 8
    *["درس 8"]*9,
    # درس 9
    *["درس 9"]*8,
    # درس 10
    *["درس 10"]*10,
    # درس 11
    *["درس 11"]*8,
    # درس 12
    *["درس 12"]*6,
    # درس 14
    *["درس 14"]*7,
    # درس 15
    *["درس 15"]*5,
    # درس 16
    *["درس 16"]*10,
    # درس 17
    *["درس 17"]*9,
]

farsi4 = [
    # درس 1: آفریدگار زیبایی
    "هم‌معنی","مخالف","هم‌خانواده","جمع و مفرد","معنی شعر","حفظ شعر","نمودار جمله","واژه‌آموزی","املا","علائم نگارشی","ترکیب",
    # درس 2: کوچ پرستوها
    "هم‌معنی","مخالف","هم‌خانواده","جمع و مفرد","نمودار جمله","واژه‌آموزی","املا","درک مطلب","علائم نگارشی","ترکیب",
    # درس 3: راز نشانه‌ها
    "هم‌معنی","مخالف","هم‌خانواده","جمع و مفرد","ضرب المثل","معنی شعر","حفظ شعر","نمودار جمله","واژه‌آموزی","املا","درک مطلب","علائم نگارشی",
    # درس 4: ارزش علم
    "هم‌معنی","مخالف","هم‌خانواده","نمودار جمله","واژه‌آموزی","درک مطلب","علائم نگارشی","ترکیب",
    # درس 5: رهایی از قفس
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 6: آرش کمان‌گیر
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","حفظ شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 7: مهمان شهر ما
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 10: باغچه‌ی اطفال
    "هم‌معنی","مخالف","هم‌خانواده","معنی شعر","حفظ شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 11: فرمانده دل‌ها
    "هم‌معنی","مخالف","هم‌خانواده","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 12: اتفاق ساده
    "هم‌معنی","مخالف","هم‌خانواده","معنی شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 13: لطف حق
    "هم‌معنی","مخالف","هم‌خانواده","معنی شعر","حفظ شعر","واژه‌آموزی","ترکیب",
    # درس 14: ادب از که آموختی؟
    "هم‌معنی","مخالف","هم‌خانواده","واژه‌آموزی","ترکیب",
    # درس 15: شیر و موش
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","نمودار جمله","واژه‌آموزی","انواع جمله","علائم نگارشی","ترکیب",
    # درس 16: پرسشگری
    "هم‌معنی","مخالف","هم‌خانواده","معنی شعر","حفظ شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 17: مدرسه‌ی هوشمند
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
]

chapters_farsi4 = [
    *["درس 1"]*11,
    *["درس 2"]*10,
    *["درس 3"]*12,
    *["درس 4"]*8,
    *["درس 5"]*11,
    *["درس 6"]*12,
    *["درس 7"]*12,
    *["درس 10"]*11,
    *["درس 11"]*9,
    *["درس 12"]*10,
    *["درس 13"]*7,
    *["درس 14"]*5,
    *["درس 15"]*10,
    *["درس 16"]*11,
    *["درس 17"]*11,
]

farsi5 = [
    # درس 1: تماشاخانه
    "هم‌معنی","مخالف","هم‌خانواده","جمع و مفرد","معنی شعر","حفظ شعر","نمودار جمله","واژه‌آموزی","املا","علائم نگارشی","ترکیب",
    # درس 2: فضل خدا
    "هم‌معنی","مخالف","هم‌خانواده","جمع و مفرد","ضرب المثل","معنی شعر","نمودار جمله","واژه‌آموزی","املا","درک مطلب","ترکیب",
    # درس 3: رازی و ساخت بیمارستان
    "هم‌معنی","مخالف","هم‌خانواده","جمع و مفرد","معنی شعر","حفظ شعر","نمودار جمله","واژه‌آموزی","املا","درک مطلب","علائم نگارشی","ترکیب",
    # درس 4: بازرگان و پسران
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","نمودار جمله","واژه‌آموزی","درک مطلب","علائم نگارشی","ترکیب",
    # درس 5: چنار و کدوبن
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 6: سرود ملی
    "هم‌معنی","مخالف","هم‌خانواده","معنی شعر","حفظ شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 8: دفاع از میهن
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 9: نام آوران دیروز، امروز، فردا
    "هم‌معنی","مخالف","هم‌خانواده","معنی شعر","حفظ شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 10: نام نیکو
    "هم‌معنی","مخالف","هم‌خانواده","معنی شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 11: نقش خردمندان
    "هم‌معنی","مخالف","هم‌خانواده","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 13: روزی که باران می‌بارید
    "هم‌معنی","مخالف","هم‌خانواده","معنی شعر","حفظ شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 14: شجاعت
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 15: کاجستان
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 16: وقتی بوعلی کودک بود
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","حفظ شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 17: کار و تلاش
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
]

chapters_farsi5 = [
    *["درس 1"]*11,
    *["درس 2"]*11,
    *["درس 3"]*12,
    *["درس 4"]*9,
    *["درس 5"]*11,
    *["درس 6"]*11,
    *["درس 8"]*11,
    *["درس 9"]*11,
    *["درس 10"]*10,
    *["درس 11"]*9,
    *["درس 13"]*11,
    *["درس 14"]*10,
    *["درس 15"]*11,
    *["درس 16"]*12,
    *["درس 17"]*11,
]


farsi6 = [
    # درس 1: معرفت آفریدگار
    "هم‌معنی","مخالف","هم‌خانواده","جمع و مفرد","معنی شعر","نمودار جمله","واژه‌آموزی","املا","علائم نگارشی",
    # درس 2: پنجره‌های شناخت
    "هم‌معنی","مخالف","هم‌خانواده","جمع و مفرد","معنی شعر","حفظ شعر","نمودار جمله","واژه‌آموزی","املا","درک مطلب","علائم نگارشی","ترکیب",
    # درس 3: هوشیاری
    "هم‌معنی","مخالف","هم‌خانواده","جمع و مفرد","معنی شعر","حفظ شعر","نمودار جمله","واژه‌آموزی","املا","درک مطلب","علائم نگارشی","ترکیب",
    # درس 4: داستان من و شما
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","نمودار جمله","واژه‌آموزی","درک مطلب","علائم نگارشی","ترکیب",
    # درس 5: هفت خان رستم
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 6: ای وطن
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","واژه‌آموزی","درک مطلب",
    # درس 8: دریاقلی
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 9: رنج‌هایی کشیده‌ام که مپرس
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","حفظ شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 10: عطّار و جلال‌الدین محمد
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 11: شهدا خورشیدند
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 12: دوستی/مشاوره
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","حفظ شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 14: راز زندگی
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 15: میوه‌ی هنر
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","واژه‌آموزی","درک مطلب",
    # درس 16: آداب مطالعه
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","حفظ شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
    # درس 17: ستاره‌ی روشن
    "هم‌معنی","مخالف","هم‌خانواده","ضرب المثل","معنی شعر","نمودار جمله","واژه‌آموزی","درک مطلب","انواع جمله","علائم نگارشی","ترکیب",
]

chapters_farsi6 = [
    # درس 1
    *["درس 1"]*9,
    # درس 2
    *["درس 2"]*12,
    # درس 3
    *["درس 3"]*12,
    # درس 4
    *["درس 4"]*10,
    # درس 5
    *["درس 5"]*11,
    # درس 6
    *["درس 6"]*7,
    # درس 8
    *["درس 8"]*11,
    # درس 9
    *["درس 9"]*12,
    # درس 10
    *["درس 10"]*11,
    # درس 11
    *["درس 11"]*11,
    # درس 12
    *["درس 12"]*12,
    # درس 14
    *["درس 14"]*11,
    # درس 15
    *["درس 15"]*7,
    # درس 16
    *["درس 16"]*12,
    # درس 17
    *["درس 17"]*11,
]

skills_math3_chapter1 = [
    # درس 1
    "الگویابی با شکل","شمارشِ چند‌تا چند‌تا (۱)","شمارشِ چند‌تا چند‌تا (۲)","الگویابی عددی",
    # درس 2
    "تعیین خروجی","تعیین ورودی","تعیین ماشین","ترکیب ماشین‌های ورودی خروجی",
    # درس 3
    "برنامه روزانه","تبدیل ساعت",
    # درس 4
    "رنگ‌آمیزی متقارن","تقارن در شکل های هندسی","پیدا کردن خط تقارن","جمع ذهنی","مسئله‌های کلامی",
]

lessons_math3_chapter1 = [
    # درس 1: 4 مهارت
    "درس 1","درس 1","درس 1","درس 1",
    # درس 2: 4 مهارت
    "درس 2","درس 2","درس 2","درس 2",
    # درس 3: 2 مهارت
    "درس 3","درس 3",
    # درس 4: 5 مهارت
    "درس 4","درس 4","درس 4","درس 4","درس 4",
]

skills_math3_chapter2 = [
    # درس 1
    "معرفی عدد هزار","الگویابی","محاسبات ذهنی",
    # درس 2
    "عدد سازی","جدول ارزش مکانی گسترده","تبدیل ریال به تومان و برعکس","تخمین",
    # درس 3
    "مقایسه اعداد","ارزش پول",
    # درس 4
    "تقریب با استفاده از محور","تقریب","تبدیل واحد","مسئله‌های کلامی",
]

lessons_math3_chapter2 = [
    # درس 1: 3 مهارت
    "درس 1","درس 1","درس 1",
    # درس 2: 4 مهارت
    "درس 2","درس 2","درس 2","درس 2",
    # درس 3: 2 مهارت
    "درس 3","درس 3",
    # درس 4: 4 مهارت
    "درس 4","درس 4","درس 4","درس 4",
]

skills_math3_chapter3 = [
    # درس 1
    "خواندن کسر","کسر از روش شکل",
    # درس 2
    "اندازه گیری زمان","اندازه گیری طول","کسر و محور (۱)","کسر و محور (۲)",
    # درس 3
    "کسر‌های برابر با واحد","تساوی کسر‌ها از روی شکل",
    # درس 4
    "مقایسه","مقایسه کسر‌ها از روی شکل",
]

lessons_math3_chapter3 = [
    # درس 1: 2 مهارت
    "درس 1","درس 1",
    # درس 2: 4 مهارت
    "درس 2","درس 2","درس 2","درس 2",
    # درس 3: 2 مهارت
    "درس 3","درس 3",
    # درس 4: 2 مهارت
    "درس 4","درس 4",
]

skills_math3_chapter4 = [
    # درس 1
    "ضرب و شکل","ضرب و محور",
    # درس 2
    "ضرب با رسم مستطیل","بدست آوردن حاصل ضرب",
    # درس 3
    "خاصیت پخشی","خاصیت جابه‌جایی","مثال‌های عددی",
    # درس 4
    "تقسیم با محور","تقسیم","تقسیم با محور",
]

lessons_math3_chapter4 = [
    # درس 1: 2 مهارت
    "درس 1","درس 1",
    # درس 2: 2 مهارت
    "درس 2","درس 2",
    # درس 3: 3 مهارت
    "درس 3","درس 3","درس 3",
    # درس 4: 3 مهارت
    "درس 4","درس 4","درس 4",
]

skills_math3_chapter5 = [
    # درس 1
    "نام گذاری خط‌ها","شمارش نیم‌خط‌ها","چندضلعی‌ها",
    # درس 2
    "محیط اشکال ۱","محیط اشکال ۲",
    # درس 3
    "مساحت",
    # درس 4
    "مساحت تقریبی","مساحت مربع","مساحت مستطیل","مسئله‌های کلامی",
]

lessons_math3_chapter5 = [
    # درس 1: 3 مهارت
    "درس 1","درس 1","درس 1",
    # درس 2: 2 مهارت
    "درس 2","درس 2",
    # درس 3: 1 مهارت
    "درس 3",
    # درس 4: 4 مهارت
    "درس 4","درس 4","درس 4","درس 4",
]

skills_math3_chapter6 = [
    # درس 1
    "مقایسه اعداد با استفاده از شکل","مقایسه با جدول","مقایسه اعداد چهار رقمی",
    # درس 2
    "تفریق","جمع","جمع و تفریق تقریبی",
    # درس 3
    "جمع",
]

lessons_math3_chapter6 = [
    # درس 1: 3 مهارت
    "درس 1","درس 1","درس 1",
    # درس 2: 3 مهارت
    "درس 2","درس 2","درس 2",
    # درس 3: 1 مهارت
    "درس 3",
]

skills_math3_chapter7 = [
    # درس 1
    "مسئله‌های کلامی","خواندن جدول داده‌ها","نوشتن جدول",
    # درس 2
    "تعداد حالات ممکن","احتمال توصیفی","احتمال عددی",
    # درس 3
    "رسم نمودار دایره‌ای","رسم نمودار دایره‌ای از روی نموداری ستونی و برعکس",
    # درس 4
    "انتخاب نمودار مناسب برای هر موضوع",
]

lessons_math3_chapter7 = [
    # درس 1: 3 مهارت
    "درس 1","درس 1","درس 1",
    # درس 2: 3 مهارت
    "درس 2","درس 2","درس 2",
    # درس 3: 2 مهارت
    "درس 3","درس 3",
    # درس 4: 1 مهارت
    "درس 4",
]

skills_math3_chapter8 = [
    # درس 1
    "ضرب اعداد صفردار","حالت‌های خاص ضرب","محاسبات",
    # درس 2
    "ضرب تقریبی",
    # درس 3
    "ضرب یک رقمی در دو رقمی","ضرب یک رقمی در سه رقمی",
    # درس 4
    "تقسیم",
]

lessons_math3_chapter8 = [
    # درس 1: 3 مهارت
    "درس 1","درس 1","درس 1",
    # درس 2: 1 مهارت
    "درس 2",
    # درس 3: 2 مهارت
    "درس 3","درس 3",
    # درس 4: 1 مهارت
    "درس 4",
]

skills_math4_chapter1 = [
    # درس 1
    "شمردن مکعب‌ها","گسترده نویسی","جدول ارزش مکانی","تشخیص جایگاه عدد","تبدیل بین جایگاه‌ها","ارتباط بین جایگاه اعداد","ارزش ارقام در اعداد","شمارش پول","چرتکه",
    # درس 2
    "تشخیص و استفاده از رابطه در دنباله عددی","الگویابی با شکل","دنباله‌های مثلثی و مربعی","مسائلی از دنباله‌ها","مسئله‌های کلامی",
    # درس 3
    "تکمیل ماشین ورودی خروجی","ماشین‌های مرکب","تشخیص عملکرد ماشین","ماشین‌های هندسی",
    # درس 4
    "تبدیل حروف به رقم (اعداد کوچک تر از یک میلیون)","تبدیل رقم به حروف (اعداد کوچک تر از یک میلیون)","تبدیل حروف به رقم (اعداد بزرگ تر از یک میلیون)","تبدیل رقم به حروف (اعداد بزرگتر از یک میلیون)","گسترده نویسی","تقریب زدن و تخمین","مقایسه اعداد",
]

lessons_math4_chapter1 = [
    # درس 1: 9 مهارت
    "درس 1","درس 1","درس 1","درس 1","درس 1","درس 1","درس 1","درس 1","درس 1",
    # درس 2: 5 مهارت
    "درس 2","درس 2","درس 2","درس 2","درس 2",
    # درس 3: 4 مهارت
    "درس 3","درس 3","درس 3","درس 3",
    # درس 4: 7 مهارت
    "درس 4","درس 4","درس 4","درس 4","درس 4","درس 4","درس 4",
]

skills_math4_chapter2 = [
    # درس 1
    "تشخیص کسر از روی شکل و محور","مفهوم کسر","عدد مخلوط","مربع تانگرام","مفهوم مقایسه کسرها",
    # درس 2
    "جمع و تفریق کسرها با شکل ","جمع و تفریق کسرها با محور ","حالت خاص جمع و تفریق کسرها","جمع و تفریق کسرها با مخرج‌ یکسان","کامل کردن جمع و تفریق کسرها",
    # درس 3
    "کامل کردن تساوی کسرها","مقایسه کسرها ",
    # درس 4
    "حاصل ضرب عدد در کسر با محور","حاصل ضرب عدد در کسر با شکل","حاصل ضرب عدد در کسر","نصف ، ثلث ، ربع و خمس کسر (۱)","نصف ، ثلث ، ربع و خمس کسر (۲)",
]

lessons_math4_chapter2 = [
    # درس 1: 5 مهارت
    "درس 1","درس 1","درس 1","درس 1","درس 1",
    # درس 2: 5 مهارت
    "درس 2","درس 2","درس 2","درس 2","درس 2",
    # درس 3: 2 مهارت
    "درس 3","درس 3",
    # درس 4: 5 مهارت
    "درس 4","درس 4","درس 4","درس 4","درس 4",
]

skills_math4_chapter3 = [
    # درس 1
    "ضرب فرایندی"," پیدا کردن حالت های مطلوب در ضرب","ضرب در عدد دو رقمی","ضرب در عدد یک رقمی","ضرب سه رقم در سه رقم",
    # درس 2
    "حالت های خاص ضرب","مسئله‌های کلامی",
    # درس 3
    "تقریب زدن عدد","استفاده از عدد های تقریبی در جمع و تفریق","استفاده از عدد های تقریبی در ضرب","استفاده از عدد های تقریبی در تقسیم","تقریب در تبدیل واحد",
    # درس 4
    "رابطه تقسیم",
    # درس 5
    "تقسیم عدد دو رقمی بر یک رقمی",
    # درس 6
    "تقسیم عدد دو رقمی بر دو رقمی","تقسیم عدد سه رقمی بر دو رقمی","مسئله‌های کلامی",
]

lessons_math4_chapter3 = [
    # درس 1: 5 مهارت
    "درس 1","درس 1","درس 1","درس 1","درس 1",
    # درس 2: 2 مهارت
    "درس 2","درس 2",
    # درس 3: 5 مهارت
    "درس 3","درس 3","درس 3","درس 3","درس 3",
    # درس 4: 1 مهارت
    "درس 4",
    # درس 5: 1 مهارت
    "درس 5",
    # درس 6: 3 مهارت
    "درس 6","درس 6","درس 6",
]

skills_math4_chapter4 = [
    # درس 1
    "تشخیص نوع زاویه",
    # درس 2
    "محاسبه ی زاویه","محاسبه ی زاویه ی مثلث","انتخاب زاویه روی نقاله","تشخیص زاویه با نقاله",
    # درس 3
    "مسائل زمان","مسائل فاصله‌ی زمانی","تبدیل واحد های زمانی ","یافتن واحد زمانی مناسب",
    # درس 4
    "اشکال به هم چسبیده","کسری از یک طول","محاسبه‌ی طول ها با نوار",
]

lessons_math4_chapter4 = [
    # درس 1: 1 مهارت
    "درس 1",
    # درس 2: 4 مهارت
    "درس 2","درس 2","درس 2","درس 2",
    # درس 3: 4 مهارت
    "درس 3","درس 3","درس 3","درس 3",
    # درس 4: 3 مهارت
    "درس 4","درس 4","درس 4",
]

skills_math4_chapter5 = [
    # درس 1
    "نمایش اعداد مخلوط روی محور","مقایسه ی اعداد مخلوط",
    # درس 2
    "نمایش اعداد اعشاری با شکل","تبدیل بین کسر و عدد اعشاری","نمایش اعداد اعشاری روی محور","نوشتن اعداد اعشاری به حروف و رقم",
    # درس 3
    "جمع و تفریق اعداد اعشاری با تبدیل به کسر","جمع و تفریق کسرها با تبدیل به عدد اعشاری","جمع و تفریق تقریبی اعداد اعشاری","مقایسه ی اعداد اعشاری",
    # درس 4
    
    "جدول ارزش مکانی برای اعداد اعشاری","جمع و تفریق عدد اعشاری با استفاده از جدول ارزش مکانی",
]

lessons_math4_chapter5 = [
    # درس 1: 2 مهارت
    "درس 1","درس 1",
    # درس 2: 4 مهارت
    "درس 2","درس 2","درس 2","درس 2",
    # درس 3: 4 مهارت
    "درس 3","درس 3","درس 3","درس 3",
    # درس 4: 2 مهارت
    "درس 4","درس 4",
]

skills_math4_chapter6 = [
    # درس 1
    "خطوط عمود و موازی","خطوط موازی و مورب",
    # درس 2
    "انواع چهارضلعی‌ها","ضلع و زاویه‌ی چهارضلعی‌ها","خواص چهارضلعی‌ها",
    # درس 3
    "رسم ارتفاع","مسائل کلامی","محاسبه‌ی مساحت به چند روش",
    # درس 4
    "مسائل کلامی","مساحت","محیط و مساحت","مساحت شکل‌های خاص",
]

lessons_math4_chapter6 = [
    # درس 1: 2 مهارت
    "درس 1","درس 1",
    # درس 2: 3 مهارت
    "درس 2","درس 2","درس 2",
    # درس 3: 3 مهارت
    "درس 3","درس 3","درس 3",
    # درس 4: 4 مهارت
    "درس 4","درس 4","درس 4","درس 4",
]

skills_math4_chapter7 = [
    # درس 1
    "نمودار ستونی","نمودار خط شکسته",
    # درس 2
    "سوالات احتمال",
]

lessons_math4_chapter7 = [
    # درس 1: 2 مهارت
    "درس 1","درس 1",
    # درس 2: 1 مهارت
    "درس 2",
]

skills_math5_chapter1 = [
    # درس 1
    "تشخیص جایگاه عدد","گسترده نویسی","مقایسه اعداد","جمع و تفریق اعداد به صورت نوشتاری","محاسبات عددی",
    # درس 2
    "شمردن مکعب‌ها","تبدیل حروف به رقم ","تبدیل رقم به حروف","تقریب","شمارش پول","نمایش اعداد روی محور",
    # درس 3
    "ساعت","الگو‌های عددی مربوط به زمان","جمع و تفریق زمان","جمع و تفریق جرم","جمع و تفریق طول","تبدیل واحد جرم و طول","تبدیل واحد زمان",
    # درس 4
    "تشخیص و استفاده از رابطه در دنباله عددی","مسائلی از دنباله‌ها","دنباله‌های مثلثی و مربعی","الگویابی با شکل",
]

lessons_math5_chapter1 = [
    # درس 1: 5 مهارت
    "درس 1","درس 1","درس 1","درس 1","درس 1",
    # درس 2: 6 مهارت
    "درس 2","درس 2","درس 2","درس 2","درس 2","درس 2",
    # درس 3: 7 مهارت
    "درس 3","درس 3","درس 3","درس 3","درس 3","درس 3","درس 3",
    # درس 4: 4 مهارت
    "درس 4","درس 4","درس 4","درس 4",
]

skills_math5_chapter2 = [
    # درس 1
    "تشخیص کسر از روی شکل","تشخیص کسر از روی محور","تبدیل عدد مخلوط و کسر به یکدیگر","مقایسه اعداد مخلوط و کسرها","مقایسه اعداد مخلوط و کسرها با کمک شکل","رنگ کردن شکل",
    # درس 2
    "جمع و تفریق اعداد مخلوط با مخرج برابر با شکل","تبدیل حاصل جمع یا تفریق به عدد مخلوط","جمع و تفریق اعداد مخلوط با مخرج برابر",
    # درس 3
    "ضرب کسر با صورت یک در عدد","ضرب کسر در عدد با کمک شکل","ضرب دو کسر با کمک شکل",
    # درس 4
    "تقسیم عدد بر عدد","تقسیم عدد بر کسر","تقسیم کسر بر عدد",
    # درس 5
    "ضرب دو عدد مخلوط با روش مساحتی","ضرب و ساده کردن کسرها","تساوی کسرها","ضرب دو عدد مخلوط","مسئله‌های کلامی",
]

lessons_math5_chapter2 = [
    # درس 1: 6 مهارت
    "درس 1","درس 1","درس 1","درس 1","درس 1","درس 1",
    # درس 2: 3 مهارت
    "درس 2","درس 2","درس 2",
    # درس 3: 3 مهارت
    "درس 3","درس 3","درس 3",
    # درس 4: 3 مهارت
    "درس 4","درس 4","درس 4",
    # درس 5: 5 مهارت
    "درس 5","درس 5","درس 5","درس 5","درس 5",
]

skills_math5_chapter3 = [
    # درس 1
    "محاسبه نسبت از روی طول","محاسبه نسبت‌ها با شمارش","محاسبه ی نسبت‌ها از روی شکل","مسئله‌های کلامی",
    # درس 2
    "محاسبه نسبت های مساوی با توجه به شکل","یافتن کوچکترین نسبت","مسئله‌های کلامی",
    # درس 3
    "تناسب","مسئله‌های کلامی ۱","مسئله‌های کلامی ۲",
    # درس 4
    "مفهوم درصد با توجه به شکل","تبدیل نسبت به درصد","محاسبه ی درصدی از یک عدد",
]

lessons_math5_chapter3 = [
    # درس 1: 4 مهارت
    "درس 1","درس 1","درس 1","درس 1",
    # درس 2: 3 مهارت
    "درس 2","درس 2","درس 2",
    # درس 3: 3 مهارت
    "درس 3","درس 3","درس 3",
    # درس 4: 3 مهارت
    "درس 4","درس 4","درس 4",
]

skills_math5_chapter4 = [
    # درس 1
    "تقارن نقطه نسبت به خط","تشخیص خط تقارن","رنگ‌آمیزی قرینه‌ی محوری شکل","رسم خط‌های تقارن","رسم قرینه‌ی شکل",
    # درس 2
    "تشخیص تقارن مرکزی","تشخیص مرکز تقارن","رنگ‌آمیزی قرینه‌ی مرکزی شکل","رسم قرینه‌ی مرکزی یک شکل",
    # درس 3
    "یافتن زاویه داخلی انواع مثلث","مسائل تستی نیمساز","مسائل نیمساز","محاسبه‌ی زاویه","محاسبه‌ی زاویه با نیمساز مثلث",
    # درس 4
    "آشنایی با چندضلعی‌ها",
]

lessons_math5_chapter4 = [
    # درس 1: 5 مهارت
    "درس 1","درس 1","درس 1","درس 1","درس 1",
    # درس 2: 4 مهارت
    "درس 2","درس 2","درس 2","درس 2",
    # درس 3: 5 مهارت
    "درس 3","درس 3","درس 3","درس 3","درس 3",
    # درس 4: 1 مهارت
    "درس 4",
]

skills_math5_chapter5 = [
    # درس 1
    "انواع نمایش اعداد اعشاری","اعداد اعشاری به رقم و حروف","نمایش اعداد اعشاری روی محور","الگویابی با اعداد اعشاری","گسترده نویسی اعداد اعشاری","نمایش اعداد اعشاری در جدول ارزش مکانی","مقایسه اعداد اعشاری","تبدیل کسر به عدد اعشاری و برعکس",        
    # درس 2
    "جمع اعداد اعشاری در جدول ارزش مکانی","جمع تقریبی اعداد اعشاری","ماشین جمع برای اعداد اعشاری","محاسبه ی محیط اشکال",
    # درس 3
    "تفریق اعداد اعشاری","تفریق اعداد اعشاری در جدول ارزش مکانی","محاسبه ی محیط اشکال","ماشین تفریق برای اعداد اعشاری",
    # درس 4
    "ضرب اعداد اعشاری با تبدیل به کسر","حالت خاص ضرب اعداد اعشاری","ضرب تقریبی اعداد اعشاری","ماشین ضرب برای اعداد اعشاری","مسئله‌های کلامی",
]

lessons_math5_chapter5 = [
    # درس 1: 8 مهارت
    "درس 1","درس 1","درس 1","درس 1","درس 1","درس 1","درس 1","درس 1",
    # درس 2: 4 مهارت
    "درس 2","درس 2","درس 2","درس 2",
    # درس 3: 4 مهارت
    "درس 3","درس 3","درس 3","درس 3",
    # درس 4: 5 مهارت
    "درس 4","درس 4","درس 4","درس 4","درس 4",
]

skills_math5_chapter6 = [
    # درس 1
    "مساحت لوزی و ذوزنقه","مسائل کلامی","مساحت شکل‌ٰهای ترکیبی",
    # درس 2
    "محیط دایره","سوالات ساعت","مسائل کلامی","محیط شکل‌های ترکیبی",
    # درس 3
    "واحد‌های اندازه‌گیری","حجم مکعب و مکعب مستطیل","محاسبه‌ی حجم اشکال ترکیبی",
    # درس 4
    "تبدیل واحدها","مسائل کلامی",
]

lessons_math5_chapter6 = [
    # درس 1: 3 مهارت
    "درس 1","درس 1","درس 1",
    # درس 2: 4 مهارت
    "درس 2","درس 2","درس 2","درس 2",
    # درس 3: 3 مهارت
    "درس 3","درس 3","درس 3",
    # درس 4: 2 مهارت
    "درس 4","درس 4",
]

skills_math5_chapter7 = [
    # درس 1
    "نمودار ستونی ","نمودار دایره‌ای ","نمودار شکسته","مسائل نمودارها",
    # درس 2
    "میانگین","مسائل میانگین",
    # درس 3
    "مفهوم احتمال",
]

lessons_math5_chapter7 = [
    # درس 1: 4 مهارت
    "درس 1","درس 1","درس 1","درس 1",
    # درس 2: 2 مهارت
    "درس 2","درس 2",
    # درس 3: 1 مهارت
    "درس 3",
]

skills_math6_chapter1 = [
    # درس 1
    "دنباله‌ عددی","اعداد زوج و فرد","الگویابی با شکل","دنباله‌های مثلثی و مربعی","مضارب ۳ و ۵","مسائلی از دنباله‌ها",
    # درس 2
    "تشخیص جایگاه عدد","گسترده نویسی","رقم به حروف / حروف به رقم","مقایسه اعداد","ساختن عدد ","یافتن عدد در محور",
    # درس 3
    "بخش‌پذیری","پیدا کردن رقم مناسب",
    # درس 4
    "مقایسه‌ی اعداد","مسائل ساعت‌ و طبقه","الگویابی با محور","مسائل عقربه ",
]

lessons_math6_chapter1 = [
    # درس 1: 6 مهارت
    "درس 1","درس 1","درس 1","درس 1","درس 1","درس 1",
    # درس 2: 6 مهارت
    "درس 2","درس 2","درس 2","درس 2","درس 2","درس 2",
    # درس 3: 2 مهارت
    "درس 3","درس 3",
    # درس 4: 4 مهارت
    "درس 4","درس 4","درس 4","درس 4",
]

skills_math6_chapter2 = [
    # درس 1
    " تقریب کسرها","جمع و تفریق کسرها با کوچک‌ترین مخرج مشترک","جمع و تفریق کسرها","مسائلی از کسرها","به دست آوردن کوچک‌ترین مخرج مشترک",
    # درس 2
    "ضرب کسرها","معکوس کردن کسرها","تقریب حاصل‌ضرب کسرها","تساوی کسرها","نصف، ثلث، ربع و خمس کسر","مسائلی از ضرب کسرها",
    # درس 3
    "تقسیم کسرها","تقسیم کسرهای با مخرج مساوی","تقسیم و ساده کردن کسرها","کامل کردن تقسیم کسرها",
    # درس 4
    "کسر مرکب","مقایسه کسرها","یافتن کسر بین دو عدد","مرتب کردن کسرها","مسائلی از کسرها",
]

lessons_math6_chapter2 = [
    # درس 1: 5 مهارت
    "درس 1","درس 1","درس 1","درس 1","درس 1",
    # درس 2: 6 مهارت
    "درس 2","درس 2","درس 2","درس 2","درس 2","درس 2",
    # درس 3: 4 مهارت
    "درس 3","درس 3","درس 3","درس 3",
    # درس 4: 5 مهارت
    "درس 4","درس 4","درس 4","درس 4","درس 4",
]

skills_math6_chapter3 = [
    # درس 1
    "تبدیل عدد اعشاری به کسر و برعکس","تبدیل عدد اعشاری به عدد مخلوط و برعکس","پیدا کردن عدد اعشاری و کسر از روی شکل","جدول ارزش مکانی اعداد اعشاری"," جمع و تفریق اعداد اعشاری","گسترده نویسی اعداد اعشاری و مخلوط","مقایسه ی اعداد اعشاری","پیدا کردن مجهول","جمع و تفریق اعداد اعشاری با تبدیل به کسر","مسئله‌های کلامی",
    # درس 2
    "ضرب مساحتی اعداد اعشاری","محاسبات با اعداد اعشاری","تقسیم اعداد اعشاری بر یک عدد طبیعی با تبدیل به کسر","حالت های خاص تقسیم اعشاری","ساده کردن کسر با اعداد اعشاری",
    # درس 3
    "تقسیم خلاصه شده یک عدد اعشاری بر یک عدد طبیعی","تقسیم عدد اعشاری بر عدد طبیعی","تبدیل کسر به عدد اعشاری",
    # درس 4
    "حالت های خاص عدد اعشاری","تقسیم با استفاده از محور","تقسیم چکشی اعداد اعشاری","تقسیم اعداد اعشاری با تبدیل به کسر ۲","تقسیم اعداد اعشاری با تبدیل به کسر ۳","تقسیم اعداد اعشاری",
]

lessons_math6_chapter3 = [
    # درس 1: 10 مهارت
    "درس 1","درس 1","درس 1","درس 1","درس 1","درس 1","درس 1","درس 1","درس 1","درس 1",
    # درس 2: 5 مهارت
    "درس 2","درس 2","درس 2","درس 2","درس 2",
    # درس 3: 3 مهارت
    "درس 3","درس 3","درس 3",
    # درس 4: 6 مهارت
    "درس 4","درس 4","درس 4","درس 4","درس 4","درس 4",
]

skills_math6_chapter4 = [
    # درس 1
    "تشخیص تقارن مرکزی","تشخیص مرکز تقارن","رنگ‌آمیزی قرینه‌ی مرکزی شکل","رسم قرینه‌ی مرکزی یک شکل","رسم خط‌های تقارن",
    # درس 2
    "مسائل دوران",
    # درس 3
    "یافتن مختصات نقاط","یافتن مساحت با استفاده از مختصات",
    # درس 4
    "تقارن نقطه نسبت به خط","تشخیص محور تقارن","رنگ‌آمیزی قرینه‌ی محوری شکل","رسم قرینه‌ شکل","یافتن مرکز تقارن",
]

lessons_math6_chapter4 = [
    # درس 1: 5 مهارت
    "درس 1","درس 1","درس 1","درس 1","درس 1",
    # درس 2: 1 مهارت
    "درس 2",
    # درس 3: 2 مهارت
    "درس 3","درس 3",
    # درس 4: 5 مهارت
    "درس 4","درس 4","درس 4","درس 4","درس 4",
]

skills_math6_chapter5 = [
    # درس 1
    "نوع و واحد اندازه گیری","واحد های طول","واحد های سطح","مساحت شکل های شبکه ای","تبدیل واحد سطح","مسئله‌های کلامی",
    # درس 2
    "گسترده ی حجم ها","تبدیل واحد حجم و جرم","محاسبه ی حجم با شمارش مکعب ها","حجم مکعب و مکعب مستطیل","مسئله‌های کلامی",
    # درس 3
    "محاسبه ی مساحت دایره",
    # درس 4
    "زاویه های مکمل و متمم","پیدا کردن زاویه ی مجهول","رسم شکل ها در دایره",
]

lessons_math6_chapter5 = [
    # درس 1: 6 مهارت
    "درس 1","درس 1","درس 1","درس 1","درس 1","درس 1",
    # درس 2: 5 مهارت
    "درس 2","درس 2","درس 2","درس 2","درس 2",
    # درس 3: 1 مهارت
    "درس 3",
    # درس 4: 3 مهارت
    "درس 4","درس 4","درس 4",
]

skills_math6_chapter6 = [
    # درس 1
    "سوالات نسبت","جدول تناسب","مسائل کلامی نسبت",
    # درس 2
    "تبدیل کسر به درصد","نمایش درصد با شکل","مسائل کلامی درصد","مفهوم درصد","مقیاس",
    # درس 3
    "مسائل درصد","مسائل مالیات و تورم","مسائل تخفیف",
    # درس 4
    "سوالات  آمار","درصد در آمار",
]

lessons_math6_chapter6 = [
    # درس 1: 3 مهارت
    "درس 1","درس 1","درس 1",
    # درس 2: 5 مهارت
    "درس 2","درس 2","درس 2","درس 2","درس 2",
    # درس 3: 3 مهارت
    "درس 3","درس 3","درس 3",
    # درس 4: 2 مهارت
    "درس 4","درس 4",
]

skills_math6_chapter7 = [
    # درس 1
    "تقریب با قطع کردن","تقریب با گرد کردن","تقریب با قطع کردن (۲)","تقریب با گرد کردن (۲)",
    # درس 2
    "اندازه گیری","تقریب در محاسبات","محاسبات تقریبی","ترتیب عملیات‌های ریاضی",
]

lessons_math6_chapter7 = [
    # درس 1: 4 مهارت
    "درس 1","درس 1","درس 1","درس 1",
    # درس 2: 4 مهارت
    "درس 2","درس 2","درس 2","درس 2",]

# ------------------------------
# 1. باز کردن سایت
# ------------------------------

def open_site(p, url: str = "https://www.eduland.ir/"):
    """
    باز کردن سایت با Playwright.
    در صورت خطا: با detect_and_report_bug اسکرین‌شات و گزارش می‌گیرد.
    """
    browser = None
    context = None
    page = None
    try:
        browser = p.chromium.launch(headless=False)
        context = browser.new_context()
        page = context.new_page()
        page.goto(url)
        page.wait_for_timeout(2000)
        print(f"✅ Opened site: {url}")

        bug = detect_and_report_bug(
            page,
            chapter="system",
            skill="open_site",
            stage="after_open",
            require_submit_visible=False  
        )
        if bug:
            raise Exception(f"Site open detected bug: {bug}")

        return browser, context, page

    except Exception as e:
        print(f"❌ Failed to open site: {str(e)}")
        if page:
            detect_and_report_bug(
                page,
                chapter="system",
                skill="open_site",
                stage="exception"
            )
        if browser:
            browser.close()
        raise


# ------------------------------
# 2. لاگین
# ------------------------------

def login(page, username: str = "danesh_t1", password: str = "danesh_t1"):
    """
    پر کردن فرم لاگین و ورود به سایت.
    در صورت خطا یا ارور 500 → detect_and_report_bug.
    """
    try:
        page.fill('input[name="username"]', username)
        page.fill('input[name="password"]', password)
        page.click('button[type="submit"]')
        page.wait_for_timeout(2000)


        bug = detect_and_report_bug(
            page,
            chapter="system",
            skill="login",
            stage="after_submit"
        )
        if bug:
            raise Exception(f"Login detected bug: {bug}")

        print(f"✅ Logged in as {username}")

    except Exception as e:
        print(f"❌ Login failed: {str(e)}")
        detect_and_report_bug(
            page,
            chapter="system",
            skill="login",
            stage="exception"
        )
        raise

# ------------------------------
# 3. کلیک روی درس + مهارت‌ها
# ------------------------------

def click_subject(
    page,
    subject: str,
    subject_index: int,*,
    screenshot_prefix: str | None = None,
    wait_after_click: int = 3000,
    verbose: bool = True
) -> bool:
    """
    کلیک روی nامین دکمه یک درس مشخص و سپس کلیک روی دکمه 'مهارت‌ها'.
    برمی‌گرداند True اگر موفق بود، False اگر خطا رخ داد.
    """

    try:
        page.click("text=کلاس‌ها")
        page.wait_for_timeout(3000)

        if verbose:
            print(f"\n🔹 Trying to click {subject} number {subject_index} ...")

        buttons = page.locator(f"button:has-text('{subject}')")
        buttons.nth(subject_index - 1).click()

        if verbose:
            print(f"✅ Clicked {subject} number {subject_index}")

        if verbose:
            print("🔹 Looking for مهارت‌ها button ...")

        page.click("text=مهارت‌ها")
        if verbose:
            print("✅ Clicked مهارت‌ها button")

        page.wait_for_timeout(wait_after_click)
        return True

    except Exception as e:
        if verbose:
            print(f"❌ Could not complete subject click flow: {str(e)}")

        detect_and_report_bug(
            page,
            chapter=subject,
            skill=f"subject_{subject_index}",
            stage="click_subject",
            screenshot_prefix=screenshot_prefix or "subject",
            verbose=verbose
        )
        return False

#  ------------------------------
# 4. کلیک روی یک مهارت خاص
# ------------------------------

def click_skill(
    page,
    skill: str,
    *,
    screenshot_prefix: str | None = None,
    wait_after_click: int = 5000,
    verbose: bool = True
) -> bool:
    """
    ورود به یک مهارت خاص (مثلاً: هم‌معنی، گسترده‌نویسی و ...).
    برمی‌گرداند True اگر موفق بود، False اگر خطا رخ داد.
    """
    try:
        page.wait_for_timeout(3000)
        if verbose:
            print(f"🔹 Looking for skill: {skill} ...")

        page.click(f"text={skill}")
        if verbose:
            print(f"✅ Entered skill: {skill}")

        page.wait_for_timeout(wait_after_click)
        return True

    except Exception as e:
        if verbose:
            print(f"❌ Could not click skill '{skill}': {str(e)}")

        detect_and_report_bug(
            page,
            chapter="unknown_chapter",
            skill=skill,
            stage="click_skill",
            screenshot_prefix=screenshot_prefix or "skill",
            verbose=verbose
        )
        return False

# ------------------------------
# 5. ورود به همه مهارت‌ها + اسکرین‌شات با اسم مهارت
# ------------------------------

def click_skills_by_name(
    page,
    skills: list,
    chapters: list,
    wait_time: int = 3000,
    start: int = None,
    end: int = None,
    click_subject=None,
    use_submit_test: bool = False,
    use_go_through_levels: bool = False,
    use_solve_all_level: bool = False,
    use_solve_science_questions: bool = False,
    math_chapter_index: int = None,
    subject_index: int = None
):

    chapters_math3 = ["الگوها","عددهای چهار رقمی","عددهای کسری","ضرب‌و‌تقسیم","محیط‌ومساحت",
                      "جمع‌وتفریق","آمار‌واحتمال","ضرب‌عددها"]
    chapters_math4 = ["الگوها","کسر","ضرب و تقسیم","اندازه‌گیری","عدد مخلوط و عدد اعشاری",
                      "شکل‌های هندسی","آمار و احتمال"]
    chapters_math5 = ["عددنویسی‌ و الگوها","کسر","نسبت، تناسب و درصد","تقارن و چندضلعی‌ها",
                      "عددهای اعشاری","اندازه‌گیری","آمار و احتمال"]
    chapters_math6 = ["عدد و الگو‌های عددی","کسر","اعداد اعشاری","تقارن و مختصات",
                      "اندازه‌گیری","تناسب و درصد","تقریب"]

    math_chapters = None
    if subject_index == 3:
        math_chapters = chapters_math3
    elif subject_index == 4:
        math_chapters = chapters_math4
    elif subject_index == 5:
        math_chapters = chapters_math5
    elif subject_index == 6:
        math_chapters = chapters_math6

    if start is None:
        start = 0
    if end is None or end > len(skills):
        end = len(skills)


    pre_counts = {}
    for idx in range(start):
        s = skills[idx]
        pre_counts[s] = pre_counts.get(s, 0) + 1

    def ensure_subject_is_open():
        try:
            if (page.locator("text=کلاس‌های من").is_visible() or 
                page.locator("text=گزارش تکالیف").is_visible() or 
                page.locator("text=تکالیف جاری").is_visible()):
                print("🔄 Returned to class page → re-clicking subject...")
                if click_subject:
                    click_subject(page)
                    page.wait_for_timeout(2000)
        except Exception:
            pass

    def select_math_chapter():
        if math_chapters and math_chapter_index is not None:
            chapter_name = math_chapters[math_chapter_index].strip()
            print(f"📑 Selecting math chapter: {chapter_name}")
            btn = page.locator(f"text={chapter_name}")
            if btn.count() > 0:
                btn.first.click()
                page.wait_for_timeout(1000)
            else:
                print(f"⚠️ Chapter '{chapter_name}' not found!")

    # انتخاب فصل ریاضی
    if math_chapters:
        select_math_chapter()


    i = start
    while i < end:
        ensure_subject_is_open()

        skill = skills[i]
        chapter = chapters[i]


        nth_index = pre_counts.get(skill, 0)
        pre_counts[skill] = nth_index + 1

        print(f"\n🔹 Skill {i+1}/{len(skills)} → {skill} (occurrence #{nth_index})")

        try:

            target = None
            if page.get_by_role("link", name=skill).count() > 0:
                target = page.get_by_role("link", name=skill)
            elif page.get_by_role("button", name=skill).count() > 0:
                target = page.get_by_role("button", name=skill)
            elif page.locator(".v-card", has_text=skill).count() > 0:
                target = page.locator(".v-card", has_text=skill)
            else:
                target = page.locator(f"text={skill}")

            page.wait_for_timeout(300)

            count = target.count()
            if count == 0:
                print(f"⚠️ Skill '{skill}' not visible → scrolling...")
                last_height = 0
                while True:
                    page.mouse.wheel(0, 600)
                    page.wait_for_timeout(800)
                    ensure_subject_is_open()

                    links = page.get_by_role("link", name=skill)
                    cards = page.locator(".v-card", has_text=skill)
                    target = links if links.count() > 0 else cards
                    count = target.count()

                    if count > 0:
                        print(f"✅ Found {count} items of '{skill}' after scrolling")
                        break

                    new_height = page.evaluate("() => document.body.scrollHeight")
                    scroll_pos = page.evaluate("() => window.scrollY + window.innerHeight")

                    if scroll_pos >= new_height or new_height == last_height:
                        print(f"❌ Skill '{skill}' not found after scrolling.")
                        raise Exception(f"Skill '{skill}' not found")

                    last_height = new_height

            index_to_click = nth_index if nth_index < count else count - 1

            print(f"👉 Clicking occurrence {index_to_click} of skill '{skill}'")
            target.nth(index_to_click).scroll_into_view_if_needed()
            target.nth(index_to_click).click()

            page.wait_for_timeout(wait_time)

            submit_button = page.locator("button:has-text('ارسال پاسخ')")
            if not submit_button.is_visible():
                raise Exception("❌ مهارت باز نشد (ارسال پاسخ دیده نشد)")

            if page.locator("text=خطا در دریافت سوال").is_visible():
                print("⚠️ Error receiving question → skipping...")
                detect_and_report_bug(page, chapter, skill, stage="receive_error")
                i += 1
                continue

            if use_submit_test:
                submit_in_skill(page, skill, chapter)
            if use_go_through_levels:
                go_through_levels(page, skill, chapter)
            if use_solve_all_level:
                solve_all_levels(page, skill, chapter)
            if   use_solve_science_questions:
                solve_science_questions(page, skill, chapter)

            page.go_back()
            page.wait_for_timeout(2000)
            ensure_subject_is_open()

        except Exception as e:
            print(f"❌ Could not open skill '{skill}': {e}")
            detect_and_report_bug(page, chapter, skill, stage="exception")
            page.go_back()
            page.wait_for_timeout(2000)
            ensure_subject_is_open()

        i += 1

# ------------------------------
# 6. تست کردن  درستی سوالات همه مهارت ها 
# ------------------------------

def submit_in_skill(
    page,
    skill_name: str,
    chapter: str,
    wait_time: int = 2000,
    repeat: int = 12,
    on_fail_callback=None
):
    """
    تست داخل هر مهارت:
    - کلیک روی 'ارسال پاسخ' → بعد 'تایید' → بعد 'گرفتم'
    - این کار را n بار (repeat) انجام می‌دهد
    - خطاها و اسکرین‌شات با detect_and_report_bug مدیریت می‌شود
    """
    safe_skill = _sanitize_filename_part(skill_name)
    safe_chapter = _sanitize_filename_part(chapter)

    for attempt in range(1, repeat + 1):
        print(f"🔁 Attempt {attempt}/{repeat} for {skill_name} in {chapter}")

        try:
            # مرحله ۱: کلیک روی "ارسال پاسخ"
            try:
                page.wait_for_selector("text=ارسال پاسخ", timeout=4000)
                page.click("text=ارسال پاسخ")
                page.wait_for_timeout(800)
            except Exception:
                print("❌ ارسال پاسخ پیدا نشد.")
                tag = detect_and_report_bug(
                    page,
                    chapter,
                    skill_name,
                    stage=f"try{attempt}",
                    require_submit_visible=True
                )
                if on_fail_callback:
                    on_fail_callback(page, tag or "submit_not_found")
                return

            # مرحله ۲: بررسی خطای "خطا در دریافت سوال" یا ارورهای دیگه
            tag = detect_and_report_bug(
                page,
                chapter,
                skill_name,
                stage=f"try{attempt}",
                require_submit_visible=False
            )
            if tag: 
                if on_fail_callback:
                    on_fail_callback(page, tag)
                return

            if page.locator("text=تایید").is_visible():
                page.click("text=تایید")
                page.wait_for_timeout(wait_time)
            else:
                print("ℹ️ 'تایید' button not present, skipping...")

            try:
                page.wait_for_selector("text=گرفتم", timeout=2000)
                page.click("text=گرفتم")
                page.wait_for_timeout(wait_time)
            except:
                print("⚠️ 'گرفتم' button not found, continuing...")

        except Exception as e:
            print(f"❌ Unexpected exception at attempt {attempt}: {e}")
            tag = detect_and_report_bug(
                page,
                chapter,
                skill_name,
                stage=f"try{attempt}_exception",
                require_submit_visible=True
            )
            if on_fail_callback:
                on_fail_callback(page, tag or "exception")
            return

# ------------------------------
# 7. تست کردن سوالات همه مهارت ها 
# ------------------------------

def go_through_levels(page, skill_name: str, chapter: str, wait_time: int = 2000):
    safe_skill = _sanitize_filename_part(skill_name)
    safe_chapter = _sanitize_filename_part(chapter)

    def get_current_level():
        try:
            text = page.locator("text=/سطح/").nth(0).text_content()
            if text:
                m = re.search(r"\d+", text)
                if m:
                    return int(m.group())
        except Exception:
            pass
        return None

    def check_errors(stage: str):
        return detect_and_report_bug(
            page,
            chapter,
            skill_name,
            stage=stage,
            require_submit_visible=False
        )

    try:
        # 🔙 مرحله ۱: عقب رفتن تا وقتی پیام توقف دیده بشه
        while True:
            if (
                page.locator("text=سطح قبل وجود ندارد").is_visible()
                or page.locator("text=سطح پایینتر وجود ندارد").is_visible()
                or page.locator("text=سطح پایین تر وجود ندارد").is_visible()
            ):
                print("✅ رسیدیم به اولین سطح (پیام توقف دیده شد).")
                break

            try:
                if page.locator("text=سطح قبل").is_visible():
                    prev_level = get_current_level()
                    page.click("text=سطح قبل")
                    page.wait_for_timeout(wait_time)
                    tag = check_errors("prev")
                    if tag:
                        print(f"⚠️ Error detected at prev level: {tag}")
                        return
                    print(f"🔙 کلیک سطح قبل (سطح قبلی: {prev_level})")
                else:
                    print("❌ دکمه سطح قبل پیدا نشد.")
                    break
            except Exception as e:
                print(f"⚠️ خطا در کلیک سطح قبل: {e}")
                check_errors("prev_exception")
                break

        # 🔜 مرحله ۲: جلو رفتن تا پیام توقف جلو
        while True:
            if page.locator("text=سطح بالاتر وجود ندارد").is_visible():
                print("✅ رسیدیم به آخرین سطح.")
                break

            try:
                if page.locator("text=سطح بعد").is_visible():
                    current_level = get_current_level()
                    page.click("text=سطح بعد")
                    page.wait_for_timeout(wait_time)
                    tag = check_errors("next")
                    if tag:
                        print(f"⚠️ Error detected at next level: {tag}")
                        return
                    print(f"🔜 کلیک سطح بعد (سطح قبلی: {current_level})")
                else:
                    print("❌ دکمه سطح بعد پیدا نشد.")
                    break
            except Exception as e:
                print(f"❌ خطا در کلیک سطح بعد: {e}")
                check_errors("next_exception")
                break

    except Exception as e:
        print(f"❌ Unexpected error: {e}")
        detect_and_report_bug(
            page,
            chapter,
            skill_name,
            stage="unexpected",
            require_submit_visible=False
        )

# ------------------------------
# 8. پیدا کردن باگ و ذخیره اسکرین‌شات
# ------------------------------

def _sanitize_filename_part(s: str) -> str:
    """پاک‌سازی قسمتی از نام فایل (فقط کاراکترهای امن می‌مذاره)."""
    s = (s or "").strip()
    return re.sub(r'[\\/*?:"<>|\s]+', "_", s)
def detect_and_report_bug(
    page,
    chapter: str,
    skill: str,
    stage: str = "",
    *,
    require_submit_visible: bool = False,
    check_page_source: bool = True,
    take_screenshot: bool = True,
    screenshot_prefix: str | None = None,
    on_detect_callback: Callable | None = None,
    verbose: bool = True,
    base_dir: str = r"D:\کار\دانیو\تست\bugs"
) -> str | None:

    page_source = ""
    if check_page_source:
        try:
            page_source = page.content()
        except Exception:
            page_source = ""

    tag = None

    # --- چک 1: ارور 500 ---
    server_500_selectors = [
        "text=500 Internal Server Error",
        "text=Internal Server Error",
        "text=Server Error",
        "text=خطای سرور",
    ]
    for sel in server_500_selectors:
        try:
            if page.locator(sel).is_visible():
                tag = "error500"
                if verbose: print(f"⚠️ Detected {tag} via selector {sel}")
                break
        except Exception:
            continue

    # --- چک 2: خطا در دریافت سوال ---
    if not tag:
        try:
            if page.locator("text=خطا در دریافت سوال").is_visible():
                tag = "receive_error"
                if verbose: print("⚠️ Detected receive_error (خطا در دریافت سوال)")
        except Exception:
            pass

    # --- چک 3: خطای عمومی "مشکلی پیش اومده" ---
    if not tag:
        try:
            if page.locator("text=مشکلی پیش اومده").is_visible() or \
               page.locator("text=خدای من! مشکلی پیش اومده").is_visible():
                tag = "general_error"
                if verbose: print("⚠️ Detected general error (مشکلی پیش اومده)")
        except Exception:
            pass

    # --- چک 4: خطای Parse/JS ---
    if not tag and check_page_source and page_source:
        parse_patterns = [
            r"Parse error",
            r"Unexpected token",
            r"SyntaxError",
            r"ReferenceError",
            r"TypeError",
            r"parsing error",
            r"خطای\s*تجزیه",
            r"خطای\s*پردازش",
        ]
        for pat in parse_patterns:
            if re.search(pat, page_source, re.IGNORECASE):
                tag = "parse_error"
                if verbose: print(f"⚠️ Detected parse error by pattern: {pat}")
                break

    # --- چک 5: صفحه لود نشده ---
    if not tag and require_submit_visible:
        try:
            submit_btn = page.locator("button:has-text('ارسال پاسخ')")
            if not submit_btn.is_visible():
                tag = "not_loaded"
                if verbose: print("⚠️ submit button not visible → not_loaded")
        except Exception:
            tag = "not_loaded"
            if verbose: print("⚠️ submit button check raised exception → not_loaded")

    # --- چک 6: خطاهای اعتبارسنجی فقط در مرحله open_site ---
    if not tag and stage == "after_submit":
        try:
            if (
                page.locator("text=خطا در ارسال اطلاعات").is_visible()
                or page.locator("text=با زبان انگلیسی وارد کنید").is_visible()
                or page.locator("text=نام کاربری نباید شامل فاصله باشد").is_visible()
                or page.locator("text=رمز نباید شامل فاصله باشد").is_visible()
            ):
                tag = "input_validation_error"
                if verbose: print("⚠️ Detected input validation error at open_site stage")
        except Exception:
            pass

    # --- اگر باگی پیدا شد ---
    if tag:
        ts = datetime.datetime.now().strftime("%Y%m%d_%H%M%S")
        safe_chapter = _sanitize_filename_part(chapter or "no_chapter")
        safe_skill = _sanitize_filename_part(skill or "no_skill")
        safe_stage = _sanitize_filename_part(stage or "")

        target_dir = os.path.join(base_dir, safe_chapter, safe_skill)
        os.makedirs(target_dir, exist_ok=True)

        fname = f"{safe_chapter}_{safe_skill}"
        if safe_stage:
            fname += f"_{safe_stage}"
        fname += f"_{tag}_{ts}.png"
        fpath = os.path.join(target_dir, fname)

        if take_screenshot:
            try:
                page.screenshot(path=fpath)
                if verbose: print(f"📸 Screenshot saved: {fpath}")
            except Exception as e:
                if verbose: print(f"❌ Failed to take screenshot: {e}")

        if verbose:
            messages = {
                "error500": "❌ Detected server 500 error on page.",
                "receive_error": "❌ Detected 'خطا در دریافت سوال'.",
                "general_error": "❌ Detected general error (مشکلی پیش اومده).",
                "parse_error": "❌ Detected parse/JS error in page source.",
                "not_loaded": "❌ Skill page not loaded (submit button not visible).",
                "input_validation_error": "❌ Detected input validation error at login/open_site."
            }
            print(messages.get(tag, f"❌ Detected bug: {tag}"))

        if on_detect_callback:
            try:
                on_detect_callback(page, tag)
            except Exception as e:
                if verbose: print(f"⚠️ on_detect_callback raised: {e}")

        return tag

    if verbose: print("✅ No bug detected.")
    return None

# ------------------------------
# 9.تست کردن  سوال  و پاسخ همه مهارت ها 
# ------------------------------
def solve_all_levels(
    page,
    skill_name: str,
    chapter: str,
    wait_time: int = 2000,
    repeat_per_level: int = 1,
    on_fail_callback=None,
):
    """
    ترکیب go_through_levels و submit_in_skill:
    - رفتن به پایین‌ترین سطح
    - در هر سطح → ارسال پاسخ، تایید، گرفتم
      اگر سطحی عقب افتاد → دوبار سطح بعد می‌زنیم تا جبران شود
    - رفتن تا آخرین سطح
    """

    safe_skill = _sanitize_filename_part(skill_name)
    safe_chapter = _sanitize_filename_part(chapter)

    def check_errors(stage: str):
        return detect_and_report_bug(
            page,
            chapter,
            skill_name,
            stage=stage,
            require_submit_visible=False
        )

    def click_next_level(times=1):
        """کلیک روی دکمه سطح بعد به تعداد مشخص"""
        for t in range(times):
            if page.locator("text=سطح بعد").is_visible():
                page.click("text=سطح بعد")
                page.wait_for_timeout(wait_time)
                tag = check_errors(f"next_{t}")
                if tag:
                    print(f"⚠️ Error detected at next level click {t}: {tag}")
                    return False
                print(f"🔜 کلیک سطح بعد (بار {t+1}/{times})")
            else:
                print("❌ دکمه سطح بعد پیدا نشد.")
                return False
        return True

    # مرحله ۱: عقب رفتن تا پایین‌ترین سطح
    while True:
        if (
            page.locator("text=سطح قبل وجود ندارد").is_visible()
            or page.locator("text=سطح پایینتر وجود ندارد").is_visible()
            or page.locator("text=سطح پایین تر وجود ندارد").is_visible()
        ):
            print("✅ رسیدیم به اولین سطح (پیام توقف دیده شد).")
            break

        try:
            if page.locator("text=سطح قبل").is_visible():
                page.click("text=سطح قبل")
                page.wait_for_timeout(wait_time)
                tag = check_errors("prev")
                if tag:
                    print(f"⚠️ Error detected at prev level: {tag}")
                    return
                print("🔙 کلیک سطح قبل")
            else:
                print("❌ دکمه سطح قبل پیدا نشد.")
                break
        except Exception as e:
            print(f"⚠️ خطا در کلیک سطح قبل: {e}")
            check_errors("prev_exception")
            break

    # مرحله ۲: جلو رفتن تا آخرین سطح و حل هر سطح
    while True:
        for attempt in range(1, repeat_per_level + 1):
            print(f"🔁 Attempt {attempt}/{repeat_per_level} for {skill_name} in {chapter}")
            try:

                at_first_level = (
                    page.locator("text=سطح قبل وجود ندارد").is_visible()
                    or page.locator("text=سطح پایینتر وجود ندارد").is_visible()
                    or page.locator("text=سطح پایین تر وجود ندارد").is_visible()
                )

                try:
                    page.wait_for_selector("text=ارسال پاسخ", timeout=4000)
                    page.click("text=ارسال پاسخ")
                    page.wait_for_timeout(800)
                except Exception:
                    print("❌ ارسال پاسخ پیدا نشد.")
                    tag = detect_and_report_bug(
                        page,
                        chapter,
                        skill_name,
                        stage=f"try{attempt}",
                        require_submit_visible=True
                    )
                    if on_fail_callback:
                        on_fail_callback(page, tag or "submit_not_found")
                    return

                tag = check_errors(f"try{attempt}")
                if tag:
                    if on_fail_callback:
                        on_fail_callback(page, tag)
                    return

                if page.locator("text=تایید").is_visible():
                    page.click("text=تایید")
                    page.wait_for_timeout(wait_time)
                else:
                    print("ℹ️ 'تایید' button not present, skipping...")

                try:
                    page.wait_for_selector("text=گرفتم", timeout=2000)
                    page.click("text=گرفتم")
                    page.wait_for_timeout(wait_time)
                except:
                    print("⚠️ 'گرفتم' button not found, continuing...")

                times_to_click = 1 if at_first_level else 2
                if not click_next_level(times_to_click):
                    return

            except Exception as e:
                print(f"❌ Unexpected exception at attempt {attempt}: {e}")
                tag = detect_and_report_bug(
                    page,
                    chapter,
                    skill_name,
                    stage=f"try{attempt}_exception",
                    require_submit_visible=True
                )
                if on_fail_callback:
                    on_fail_callback(page, tag or "exception")
                return

        if page.locator("text=سطح بالاتر وجود ندارد").is_visible():
            print("✅ رسیدیم به آخرین سطح.")
            break



def solve_science_questions(
    page,
    skill_name: str,
    chapter: str,
    wait_time: int = 1500,
    on_fail_callback=None,
):

    safe_skill = _sanitize_filename_part(skill_name)
    safe_chapter = _sanitize_filename_part(chapter)

    def check_errors(stage: str):
        return detect_and_report_bug(
            page,
            chapter,
            skill_name,
            stage=stage,
            require_submit_visible=False
        )


    for i in range(15):
        try:
            try:
                page.wait_for_selector("text=ارسال پاسخ", timeout=3000)
                page.click("text=ارسال پاسخ")
                page.wait_for_timeout(700)
            except:
                print("❌ ارسال پاسخ پیدا نشد.")
                tag = detect_and_report_bug(
                    page,
                    chapter,
                    skill_name,
                    stage="submit",
                    require_submit_visible=True
                )
                if on_fail_callback:
                    on_fail_callback(page, tag or "submit_not_found")
                return

            tag = check_errors("submit")
            if tag:
                if on_fail_callback:
                    on_fail_callback(page, tag)
                return

            if page.locator("text=تایید").is_visible():
                page.click("text=تایید")
                page.wait_for_timeout(wait_time)
            else:
                print("ℹ️ 'تایید' وجود نداشت .")
            try:
                page.wait_for_selector("text=گرفتم", timeout=3000)
                page.click("text=گرفتم")
                page.wait_for_timeout(wait_time)
            except:
                print("⚠️ 'گرفتم' دیده نشد.")



        except Exception as e:
            print(f"❌ خطای غیرمنتظره: {e}")
            tag = detect_and_report_bug(
                page,
                chapter,
                skill_name,
                stage="exception",
                require_submit_visible=True
            )
            if on_fail_callback:
                on_fail_callback(page, tag or "exception")
            return
